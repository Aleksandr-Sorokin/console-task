# console-task
Приложение принимает на вход два файла **input.json** и **output.json** или один файл **input.json**

в **output.json** будут выгружены данные название **output.json** используется по умолчанию.

Если вторым файлом указать **другоеназвание.json**, то выгружено будет в **другоеназвание.json**

В файле input.json должны находиться следующие данные в формате json:

    {
    "criterias":[
        {"lastName": "Иванов"}, 
        {"productName": "Минеральная вода", "minTimes": 5},
        {"minExpenses": 112, "maxExpenses": 4000},  
        {"badCustomers": 3}
        ] 
    }
**criterias** - параметр с которого начинается чтение данных

**lastName** - lastName поиск в базе по фамилии

**productName** - "productName" поиск в базе покупателя купившего продукт не менее **"minTimes"** раз

**minExpenses и maxExpenses** - поиск покупателей купивших на сумму в этом диапазоне minExpenses и maxExpenses

**badCustomers** - количество выводимых покупателей купивших меньше всего

ИЛИ

    {
        "startDate": "2020-01-14",
        "endDate": "2020-01-26"
    }
**startDate и endDate** - период за который будет выгружена статистика без учета выходных дней

**Файлы для тестов лежат в корне ***console-task\***

    input.json
    inputstat.json
    inputstatwitherror.json
    inputwitherror.json

**Файл input.json** - необходимо положить в корень проекта ***console-task/input.json***

### Запуск программы ###
На ПК необходим установленный **MAVEN** и **DOCKER** перейти в корень **\console-task**

выполнить последовательно команды **ВАЖНО** из скачанного архива папка с программой необходимо переименовать до **console-task**, так как docker будет искать папку для запуска **console-task**

    mvn package
    docker-compose up --build -d
    java -jar target/console-task-1.0-SNAPSHOT.jar input.json output.json
    java -jar target/console-task-1.0-SNAPSHOT.jar input.json
Перейти в папку **\console-task** в консоле будет показан путь по которому расположен файл **output.json** в нем должны быть данные
### команды для проверки разных ошибок ### 

    java -jar target/console-task-1.0-SNAPSHOT.jar inputstat.json
    java -jar target/console-task-1.0-SNAPSHOT.jar inputstatwitherror.json
    java -jar target/console-task-1.0-SNAPSHOT.jar inputwitherror.json

### остановка образов docker-compose###
    docker-compose stop
    docker-compose down
### Правильный ответ для : ###
**для статистики**

    {
    "type" : "STAT",
    "totalDays" : 9,
    "customers" : [ {
    "name" : "Смирнов Петр",
    "purchases" : [ {
    "name" : "Апельсины",
    "expenses" : 246.0
    }, {
    "name" : "Мороженное \"Магнат\"",
    "expenses" : 63.0
    } ],
    "totalExpenses" : 309.0
    }, {
    "name" : "Петров ??ван",
    "purchases" : [ {
    "name" : "Минеральная вода",
    "expenses" : 270.0
    } ],
    "totalExpenses" : 270.0
    }, {
    "name" : "Петров Александр",
    "purchases" : [ {
    "name" : "Минеральная вода",
    "expenses" : 108.0
    } ],
    "totalExpenses" : 108.0
    } ],
    "totalExpenses" : 687.0,
    "avgExpenses" : 229.0
    }

**для поискового запроса**

    {
    "type" : "SEARCH",
    "results" : [ {
    "criteria" : {
    "lastName" : "Иванов"
    },
    "results" : [ {
    "firstName" : "Александр",
    "lastName" : "Иванов"
    }, {
    "firstName" : "Иван",
    "lastName" : "Иванов"
    } ]
    }, {
    "criteria" : {
    "productName" : "Минеральная вода",
    "minTimes" : 5
    },
    "results" : [ {
    "firstName" : "Александр",
    "lastName" : "Иванов"
    }, {
    "firstName" : "Иван",
    "lastName" : "Петров"
    } ]
    }, {
    "criteria" : {
    "minExpenses" : 112,
    "maxExpenses" : 4000
    },
    "results" : [ {
    "firstName" : "Петр",
    "lastName" : "Петров"
    }, {
    "firstName" : "Иван",
    "lastName" : "Иванов"
    }, {
    "firstName" : "Иван",
    "lastName" : "Петров"
    }, {
    "firstName" : "Александр",
    "lastName" : "Иванов"
    }, {
    "firstName" : "Петр",
    "lastName" : "Смирнов"
    } ]
    }, {
    "criteria" : {
    "badCustomers" : 3
    },
    "results" : [ {
    "firstName" : "Александр",
    "lastName" : "Петров"
    }, {
    "firstName" : "Петр",
    "lastName" : "Петров"
    }, {
    "firstName" : "Иван",
    "lastName" : "Иванов"
    } ]
    } ]
    }

### База данных ###

    DROP TABLE IF EXISTS purchase, product, customer;

    CREATE TABLE IF NOT EXISTS customer
    (
    customer_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    first_name VARCHAR(200) NOT NULL,
    last_name VARCHAR(200) NOT NULL
    );

    CREATE TABLE IF NOT EXISTS product
    (
    product_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    price DOUBLE PRECISION NOT NULL
    );

    CREATE TABLE IF NOT EXISTS purchase
    (
    purchase_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    customer_id BIGINT NOT NULL,
    product_id BIGINT NOT NULL,
    volume INTEGER NOT NULL,
    purchase_date TIMESTAMP NOT NULL,
    CONSTRAINT purchase_customer_id_fk
    FOREIGN KEY (customer_id) REFERENCES customer (customer_id) ON DELETE CASCADE,
    CONSTRAINT purchase_product_id_fk
    FOREIGN KEY (product_id) REFERENCES product (product_id) ON DELETE CASCADE
    );

### Данные для тестирования ###

    INSERT INTO customer (customer_id, first_name, last_name) VALUES (1, 'Александр', 'Иванов');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (2, 'Иван', 'Иванов');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (3, 'Иван', 'Петров');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (4, 'Петр', 'Петров');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (5, 'Петр', 'Смирнов');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (6, 'Александр', 'Смирнов');
    INSERT INTO customer (customer_id, first_name, last_name) VALUES (7, 'Александр', 'Петров');

    INSERT INTO product (product_id, title, price) VALUES (1, 'Минеральная вода', 54);
    INSERT INTO product (product_id, title, price) VALUES (2, 'Мороженное "Магнат"', 63);
    INSERT INTO product (product_id, title, price) VALUES (3, 'Вода 5-л', 49);
    INSERT INTO product (product_id, title, price) VALUES (4, 'Хлеб белый', 35);
    INSERT INTO product (product_id, title, price) VALUES (5, 'Хлеб черный', 42);
    INSERT INTO product (product_id, title, price) VALUES (6, 'Яблоки', 150);
    INSERT INTO product (product_id, title, price) VALUES (7, 'Апельсины', 123);
    INSERT INTO product (product_id, title, price) VALUES (8, 'Молоко', 84);

    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (1, 1, 1, 7, '2020-01-13');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (2, 1, 2, 1, '2020-01-13');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (3, 1, 3, 5, '2020-01-14');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (4, 2, 4, 5, '2020-01-14');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (5, 2, 8, 2, '2020-01-15');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (6, 3, 1, 5, '2020-01-16');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (7, 3, 6, 2, '2020-01-18');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (8, 3, 7, 1, '2020-01-19');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (9, 4, 1, 2, '2020-01-20');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (10, 4, 5, 2, '2020-01-21');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (11, 5, 6, 2, '2020-01-22');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (12, 5, 7, 2, '2020-01-23');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (13, 5, 2, 1, '2020-01-24');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (14, 5, 3, 2, '2020-01-25');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (15, 1, 6, 6, '2020-01-26');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (16, 1, 5, 2, '2020-01-27');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (17, 3, 1, 8, '2020-01-28');
    INSERT INTO purchase (purchase_id, customer_id, product_id, volume, purchase_date) VALUES (18, 7, 1, 2, '2020-01-17');
